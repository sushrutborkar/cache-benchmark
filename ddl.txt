-- drop datasets

DROP DATAVERSE w_{i} IF EXISTS;
CREATE DATAVERSE w_{i};
USE w_{i};

-- Create a set of open datatypes

CREATE TYPE genericType AS {{
    _id: uuid
}};

-- Create a set of open datasets

CREATE DATASET customer(genericType)
    PRIMARY KEY _id AUTOGENERATED;

CREATE DATASET district(genericType)
    PRIMARY KEY _id AUTOGENERATED;

CREATE DATASET history(genericType)
    PRIMARY KEY _id AUTOGENERATED;

CREATE DATASET item(genericType)
    PRIMARY KEY _id AUTOGENERATED;

CREATE DATASET nation(genericType)
    PRIMARY KEY _id AUTOGENERATED;

CREATE DATASET neworder(genericType)
    PRIMARY KEY _id AUTOGENERATED;

CREATE DATASET orders(genericType)
    PRIMARY KEY _id AUTOGENERATED;

CREATE DATASET region(genericType)
    PRIMARY KEY _id AUTOGENERATED;

CREATE DATASET stock(genericType)
    PRIMARY KEY _id AUTOGENERATED;

CREATE DATASET supplier(genericType)
    PRIMARY KEY _id AUTOGENERATED;

CREATE DATASET warehouse(genericType)
    PRIMARY KEY _id AUTOGENERATED;

-- Load data

LOAD DATASET customer   USING localfs (("path"="127.0.0.1:///home/sushrut/tpc_ch/w_{i}/customer.json"), ("format"="json"));
LOAD DATASET district   USING localfs (("path"="127.0.0.1:///home/sushrut/tpc_ch/w_{i}/district.json"), ("format"="json"));
LOAD DATASET history    USING localfs (("path"="127.0.0.1:///home/sushrut/tpc_ch/w_{i}/history.json"),  ("format"="json"));
LOAD DATASET item       USING localfs (("path"="127.0.0.1:///home/sushrut/tpc_ch/w_{i}/item.json"),     ("format"="json"));
LOAD DATASET nation     USING localfs (("path"="127.0.0.1:///home/sushrut/tpc_ch/w_{i}/nation.json"),   ("format"="json"));
LOAD DATASET neworder   USING localfs (("path"="127.0.0.1:///home/sushrut/tpc_ch/w_{i}/neworder.json"), ("format"="json"));
LOAD DATASET orders     USING localfs (("path"="127.0.0.1:///home/sushrut/tpc_ch/w_{i}/orders.json"),   ("format"="json"));
LOAD DATASET region     USING localfs (("path"="127.0.0.1:///home/sushrut/tpc_ch/w_{i}/region.json"),   ("format"="json"));
LOAD DATASET stock      USING localfs (("path"="127.0.0.1:///home/sushrut/tpc_ch/w_{i}/stock.json"),    ("format"="json"));
LOAD DATASET supplier   USING localfs (("path"="127.0.0.1:///home/sushrut/tpc_ch/w_{i}/supplier.json"), ("format"="json"));
LOAD DATASET warehouse  USING localfs (("path"="127.0.0.1:///home/sushrut/tpc_ch/w_{i}/warehouse.json"),("format"="json"));

-- create indexes

CREATE INDEX ind1 ON stock(s_i_id: int, s_quantity: int, s_w_id: int);
CREATE INDEX ind2 ON nation(n_nationkey: int);
CREATE INDEX ind3 ON region(r_regionkey: int);
CREATE INDEX ind4 ON region(r_name: string);
CREATE INDEX ind5 ON item(i_id: int);
CREATE INDEX ind6 ON item(i_data: string);
CREATE INDEX ind7 ON supplier(s_i_id: int);


ANALYZE DATASET customer;
ANALYZE DATASET district;
ANALYZE DATASET history;
ANALYZE DATASET item;
ANALYZE DATASET nation;
ANALYZE DATASET neworder;
ANALYZE DATASET orders;
ANALYZE DATASET region;
ANALYZE DATASET stock;
ANALYZE DATASET supplier;
ANALYZE DATASET warehouse;
